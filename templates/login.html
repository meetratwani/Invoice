{% extends 'base.html' %}

{% block title %}Login - R Sanju Store{% endblock %}

{% block content %}
<section class="page" style="max-width: 450px; margin: 4rem auto;">
  <div class="page-header">
    <h2 style="text-align:center;">Login to Your Store</h2>
    {% if not firebase_enabled %}
    <p style="text-align:center; color:#f59e0b; font-size:0.9rem;">âš  Running in local mode (Firebase not configured)</p>
    {% endif %}
  </div>

  <form method="post" class="form" id="login-form">
    <input type="hidden" name="id_token" id="id-token" />

    <div class="form-grid">
      <label>
        Email
        <input type="email" name="email" id="email" required autofocus />
      </label>

      <label>
        Password
        <input type="password" name="password" id="password" required />
      </label>
    </div>

    <div class="form-actions" style="justify-content:center; margin-top: 1.5rem; flex-direction: column; gap: 0.75rem;">
      <button type="submit" class="btn primary full-width" id="login-btn">Login</button>
    </div>
  </form>
</section>

{% if firebase_enabled %}
<script type="module">
  // Firebase configuration - You need to add your Firebase config here
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  // TODO: Replace with your Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const form = document.getElementById('login-form');
  const loginBtn = document.getElementById('login-btn');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    loginBtn.disabled = true;
    loginBtn.textContent = 'Logging in...';

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const idToken = await userCredential.user.getIdToken();

      // Set the token in the hidden field
      document.getElementById('id-token').value = idToken;

      // Submit the form
      form.submit();
    } catch (error) {
      console.error('Login error:', error);
      alert('Login failed: ' + error.message);
      loginBtn.disabled = false;
      loginBtn.textContent = 'Login';
    }
  });
</script>
{% endif %}
{% endblock %}