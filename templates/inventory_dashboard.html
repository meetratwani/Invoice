{% extends 'base.html' %}

{% block title %}Inventory - Managekarlo{% endblock %}

{% block content %}
<section class="page">
  <div class="page-header">
    <h2>Inventory Overview</h2>
    <a href="{{ url_for('products_list') }}" class="btn">View Products</a>
  </div>

  <div class="cards-grid">
    <div class="card">
      <h3>Total Products</h3>
      <p class="big-number">{{ summary.total_products }}</p>
    </div>
    <div class="card">
      <h3>Total Stock Qty</h3>
      <p class="big-number">{{ '%.2f'|format(summary.total_stock_qty) }}</p>
    </div>
    <div class="card">
      <h3>Stock Value (Selling)</h3>
      <p class="big-number">₹ {{ '%.2f'|format(summary.total_stock_value_selling) }}</p>
    </div>
    <div class="card">
      <h3>Stock Value (Cost)</h3>
      <p class="big-number">₹ {{ '%.2f'|format(summary.total_stock_value_cost) }}</p>
    </div>
  </div>

  <div class="two-columns">
    <div>
      <h3>Low Stock Products</h3>
      {% if summary.low_stock_products %}
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>SKU</th>
            <th>Stock</th>
            <th>Min Level</th>
          </tr>
        </thead>
        <tbody>
          {% for p in summary.low_stock_products %}
          <tr>
            <td>{{ p.name }}</td>
            <td>{{ p.sku }}</td>
            <td>{{ '%.2f'|format(p.stock_quantity or 0) }}</td>
            <td>{{ '%.2f'|format(p.min_stock_level or 0) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>All products are above their minimum stock levels.</p>
      {% endif %}
    </div>

    <div>
      <h3>Recent Stock Transactions</h3>
      {% if summary.recent_transactions %}
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Product ID</th>
            <th>Qty</th>
            <th>Reference</th>
          </tr>
        </thead>
        <tbody>
          {% for tx in summary.recent_transactions %}
          <tr>
            <td>{{ tx.date }}</td>
            <td>{{ tx.transaction_type }}</td>
            <td>{{ tx.product_id }}</td>
            <td>{{ '%.2f'|format(tx.quantity or 0) }}</td>
            <td>{{ tx.reference_id }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No stock transactions recorded yet.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}